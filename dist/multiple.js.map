{
  "version": 3,
  "sources": [
    "node_modules/browser-pack/_prelude.js",
    "index.js",
    "lib/error.js",
    "lib/filename.js",
    "lib/source.js",
    "lib/upload.js",
    "node_modules/base62/base62.js",
    "node_modules/extend/index.js"
  ],
  "names": [],
  "mappings": "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ACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "/* global window */\nimport Upload from './lib/upload';\n\nconst {defaultOptions} = Upload;\n\nmodule.exports = {\n  Upload,\n  defaultOptions\n};\n",
    "class DetailedError extends Error {\n  constructor(error, causingErr = null, xhr = null) {\n    super(error.message);\n\n    this.originalRequest = xhr;\n    this.causingError = causingErr;\n\n    let message = error.message;\n    if (causingErr != null) {\n      message += `, caused by ${causingErr.toString()}`;\n    }\n    if (xhr != null) {\n      message += `, originated from request (response code: ${xhr.status}, response text: ${xhr.responseText})`;\n    }\n    this.message = message;\n  }\n}\n\nexport default DetailedError;\n",
    "import base62 from 'base62';\n\n\n// export function getFilename () {\n//   base62.setCharacterSet('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz');\n//   let code = String(Date.now() / 7173 + Math.random(0, 1) * 17779);\n//   return code.substr(0, 8);\n// }\n\n// 综合多个随机因子，尽可能减少碰撞概率\n// 生成一个8位的唯一文件名\nexport function getFilename() {\n  base62.setCharacterSet('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz');\n\n  // 获取高精度时间戳\n  const timestamp = Date.now();\n\n  // 生成两个独立的随机数\n  const randomPart1 = Math.floor(Math.random() * 10000);\n  const randomPart2 = Math.floor(Math.random() * 10000);\n\n  // 使用performance.now()作为额外熵源（如果可用）\n  const performanceTime = window.performance && window.performance.now ?\n    Math.floor(window.performance.now() * 100) % 1000 :\n    Math.floor(Math.random() * 1000);\n\n  // 综合多个随机源\n  let uniqueNumber = (\n    (timestamp % 10000000) +\n    (randomPart1 % 1000) +\n    (randomPart2 % 100) +\n    performanceTime\n  ) % 90000000; // 最大值设为90000000而不是100000000\n\n  // 加上10000000确保第一位不是0（范围变为10000000-99999999）\n  uniqueNumber += 10000000;\n\n  return uniqueNumber.toString();\n}",
    "class FileSource {\n  constructor(file) {\n    this._file = file;\n    this.size = file.size;\n  }\n\n  slice(start, end) {\n    return this._file.slice(start, end);\n  }\n\n  close() {}\n}\n\nexport function getSource(input) {\n  if (typeof input.slice === \"function\" && typeof input.size !== \"undefined\") {\n    return new FileSource(input);\n  }\n\n  throw new Error(\"source object may only be an instance of File or Blob in this environment\");\n}",
    "import {getSource} from './source';\nimport {getFilename} from './filename';\nimport DetailedError from \"./error\";\nimport extend from 'extend';\n\nconst newRequest = () => {\n  return new window.XMLHttpRequest();\n}\n\nconst defaultOptions = {\n  endpoint: \"\",\n  onProgress: null,\n  onChunkComplete: null,\n  onSuccess: null,\n  onError: null,\n  headers: {},\n  chunkSize: Infinity,\n  withCredentials: false,\n  uploadUrl: null,\n  uploadSize: null,\n  overridePatchMethod: false,\n  retryDelays: null\n};\n\nclass Upload {\n  constructor(file, options) {\n    this.options = extend(true, {}, defaultOptions, options);\n\n    // The underlying File/Blob object\n    this.file = file;\n\n    // The URL against which the file will be uploaded\n    this.url = null;\n\n    // The underlying XHR object for the current PUT request\n    this._xhr = null;\n\n    // The offset used in the current PUT request\n    this._offset = null;\n\n    // True if the current PUT request has been aborted\n    this._aborted = false;\n\n    // The file's size in bytes\n    this._size = null;\n\n    // The Source object which will wrap around the given file and provides us\n    // with a unified interface for getting its size and slice chunks from its\n    // content allowing us to easily handle Files, Blobs, Buffers and Streams.\n    this._source = null;\n\n    // The current count of attempts which have been made. Null indicates none.\n    this._retryAttempt = 0;\n\n    // The timeout's ID which is used to delay the next retry\n    this._retryTimeout = null;\n\n    // The offset of the remote upload before the latest attempt was started.\n    this._offsetBeforeRetry = 0;\n\n    // The uuid is upyun return id for multiple upload\n    this._uuid = null;\n\n    // 兼容腾讯cos上传的逻辑，后续不再使用此bao\n    this._cosUploadId = null;\n    this._parts = [];\n  }\n  _emitXhrError(xhr, err, causingErr) {\n    this._emitError(new DetailedError(err, causingErr, xhr));\n  }\n\n  _emitError(err) {\n    if (typeof this.options.onError === \"function\") {\n      this.options.onError(err);\n    } else {\n      throw err;\n    }\n  }\n\n  _emitSuccess() {\n    if (typeof this.options.onSuccess === \"function\") {\n      this.options.onSuccess();\n    }\n  }\n  /**\n   * Publishes notification when data has been sent to the server. This\n   * data may not have been accepted by the server yet.\n   * @param  {number} bytesSent  Number of bytes sent to the server.\n   * @param  {number} bytesTotal Total number of bytes to be sent to the server.\n   */\n  _emitProgress(bytesSent, bytesTotal) {\n    if (typeof this.options.onProgress === \"function\") {\n      this.options.onProgress(bytesSent, bytesTotal);\n    }\n  }\n\n  /**\n   * Publishes notification when a chunk of data has been sent to the server\n   * and accepted by the server.\n   * @param  {number} chunkSize  Size of the chunk that was accepted by the\n   *                             server.\n   * @param  {number} bytesAccepted Total number of bytes that have been\n   *                                accepted by the server.\n   * @param  {number} bytesTotal Total number of bytes to be sent to the server.\n   */\n  _emitChunkComplete(chunkSize, bytesAccepted, bytesTotal) {\n    if (typeof this.options.onChunkComplete === \"function\") {\n      this.options.onChunkComplete(chunkSize, bytesAccepted, bytesTotal);\n    }\n  }\n\n  _setupXHR(xhr) {\n    let headers = this.options.headers;\n\n    for (let name in headers) {\n      xhr.setRequestHeader(name, headers[name]);\n    }\n  }\n\n\n  start () {\n    let file = this.file;\n    if (!file) {\n      this._emitError(new Error(\"no file to upload provided\"));\n      return;\n    }\n\n    if (!this.options.endpoint) {\n        this._emitError(new Error(\"no endpoint provided\"));\n        return;\n    }\n    let ext = '.' + file.name.split('.').pop();\n    this.url = this.options.endpoint + getFilename() + ext;\n\n    let source = this._source = getSource(file, this.options.chunkSize);\n    let size = source.size;\n    this._size = size;\n    let xhr = newRequest();\n    xhr.open(\"PUT\", this.url, true);\n\n    xhr.onload = (e) => {\n      if (!(xhr.status >= 200 && xhr.status < 300)) {\n        this._emitXhrError(xhr, new Error(\"unexpected response while creating upload\"));\n        return;\n      }\n      let nextId = Number(e.currentTarget.getResponseHeader('x-upyun-next-part-id'));\n      this._uuid = e.currentTarget.getResponseHeader('x-upyun-multi-uuid');\n      this._cosUploadId = e.currentTarget.getResponseHeader('x-cos-upload-id');\n      this._offset = 0;\n      this._startUpload(nextId);\n    };\n\n    xhr.onerror = (err) => {\n      this._emitXhrError(xhr, new Error(\"failed to create upload\"), err);\n    };\n\n    this._setupXHR(xhr);\n    xhr.setRequestHeader(\"X-Upyun-Multi-Stage\", \"initiate\");\n    xhr.setRequestHeader(\"X-Upyun-Multi-Length\", size);\n\n    xhr.send(null);\n  }\n\n  _startUpload (nextId) {\n    if (this._aborted) {\n      return;\n    }\n\n    let xhr = this._xhr = newRequest();\n\n    xhr.open(\"PUT\", this.url, true);\n\n    xhr.onload = (e) => {\n      if (!(xhr.status >= 200 && xhr.status < 300)) {\n        this._emitXhrError(xhr, new Error(\"unexpected response while uploading chunk\"));\n        return;\n      }\n      nextId = Number(e.currentTarget.getResponseHeader('x-upyun-next-part-id'));\n\n      // 如果有cos返回的etag ，则存起来，等complete时用到\n      const cosEtag = e.currentTarget.getResponseHeader('x-cos-part-etag');\n      if (cosEtag) {\n        this._parts.push({\n          PartNumber: nextId === -1 ? this._parts.length + 1 : nextId,\n          ETag: cosEtag\n        });\n      }\n\n      this._emitProgress(this._offset, this._size);\n      if (nextId == -1) return this._complete();\n\n      this._startUpload(nextId);\n    };\n\n    xhr.onerror = (err) => {\n      // Don't emit an error if the upload was aborted manually\n      if (this._aborted) {\n        return;\n      }\n\n      this._emitXhrError(xhr, new Error(\"failed to upload chunk at offset \" + this._offset), err);\n    };\n\n    this._setupXHR(xhr);\n\n    xhr.setRequestHeader(\"Content-Type\", \"application/offset+octet-stream\");\n    xhr.setRequestHeader(\"x-upyun-multi-uuid\", this._uuid);\n    xhr.setRequestHeader(\"x-upyun-part-id\", String(nextId));\n    xhr.setRequestHeader(\"X-Upyun-Multi-Stage\", \"upload\");\n    xhr.setRequestHeader(\"x-cos-upload-id\", this._cosUploadId);\n    let start = this._offset;\n    let end = this._offset + this.options.chunkSize;\n\n    // The specified chunkSize may be Infinity or the calcluated end position\n    // may exceed the file's size. In both cases, we limit the end position to\n    // the input's total size for simpler calculations and correctness.\n    if (end === Infinity || end > this._size) {\n      end = this._size;\n    }\n    this._offset = end;\n\n    xhr.send(this._source.slice(start, end));\n  }\n\n  _complete () {\n    // If the upload has been aborted, we will not send the next PATCH request.\n    // This is important if the abort method was called during a callback, such\n    // as onChunkComplete or onProgress.\n    if (this._aborted) {\n      return;\n    }\n\n    let xhr = this._xhr = newRequest();\n\n    xhr.open(\"PUT\", this.url, true);\n\n    xhr.onload = () => {\n      if (!(xhr.status >= 200 && xhr.status < 300)) {\n        this._emitXhrError(xhr, new Error(\"unexpected response while uploading chunk\"));\n        return;\n      }\n\n      let offset = this._offset;\n      if (isNaN(offset)) {\n        this._emitXhrError(xhr, new Error(\"invalid or missing offset value\"));\n        return;\n      }\n\n      this._offset = offset;\n      if (offset == this._size) {\n        // Yay, finally done :)\n        this._emitSuccess();\n        this._source.close();\n        return;\n      }\n    };\n\n    xhr.onerror = (err) => {\n      // Don't emit an error if the upload was aborted manually\n      if (this._aborted) {\n        return;\n      }\n\n      this._emitXhrError(xhr, new Error(\"failed to upload chunk at offset \" + this._offset), err);\n    };\n\n    this._setupXHR(xhr);\n\n    xhr.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n    xhr.setRequestHeader(\"X-Upyun-Multi-Stage\", \"complete\");\n    xhr.setRequestHeader(\"x-upyun-multi-uuid\", this._uuid);\n    xhr.setRequestHeader(\"x-cos-upload-id\", this._cosUploadId);\n    let data = this.options.onCompletePostData || {};\n    if (this._parts.length > 0) {\n      data.parts = this._parts;\n    }\n    xhr.send(JSON.stringify(data));\n  }\n}\n\nUpload.defaultOptions = defaultOptions;\n\nexport default Upload;",
    "module.exports = (function (Base62) {\n    \"use strict\";\n\n    var DEFAULT_CHARACTER_SET = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n\n    Base62.encode = function(integer){\n        if (integer === 0) {return '0';}\n        var s = '';\n        while (integer > 0) {\n            s = Base62.characterSet[integer % 62] + s;\n            integer = Math.floor(integer/62);\n        }\n        return s;\n    };\n\n    var defaultCharsetDecode = function defaultCharsetDecode (base62String) {\n        var value = 0,\n            i = 0,\n            length = base62String.length,\n            charValue;\n\n        for (; i < length; i++) {\n            charValue = base62String.charCodeAt(i);\n\n            if (charValue < 58) {\n                charValue = charValue - 48;\n            } else if (charValue < 91) {\n                charValue = charValue - 29;\n            } else {\n                charValue = charValue - 87;\n            }\n\n            value += charValue * Math.pow(62, length - i - 1);\n        }\n\n        return value;\n    };\n\n    var customCharsetDecode = function customCharsetDecode (base62String) {\n        var val = 0,\n            i = 0,\n            length = base62String.length,\n            characterSet = Base62.characterSet;\n\n        for (; i < length; i++) {\n            val += characterSet.indexOf(base62String[i]) * Math.pow(62, length - i - 1);\n        }\n\n        return val;\n    };\n\n    var decodeImplementation = null;\n\n    Base62.decode = function(base62String){\n        return decodeImplementation(base62String);\n    };\n\n    Base62.setCharacterSet = function(chars) {\n        var arrayOfChars = chars.split(\"\"), uniqueCharacters = [];\n\n        if(arrayOfChars.length !== 62) throw Error(\"You must supply 62 characters\");\n\n        arrayOfChars.forEach(function(char){\n            if(!~uniqueCharacters.indexOf(char)) uniqueCharacters.push(char);\n        });\n\n        if(uniqueCharacters.length !== 62) throw Error(\"You must use unique characters.\");\n\n        Base62.characterSet = arrayOfChars;\n\n        decodeImplementation = chars === DEFAULT_CHARACTER_SET ? defaultCharsetDecode : customCharsetDecode;\n    };\n\n    Base62.setCharacterSet(DEFAULT_CHARACTER_SET);\n    return Base62;\n}({}));\n",
    "'use strict';\n\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar toStr = Object.prototype.toString;\n\nvar isArray = function isArray(arr) {\n\tif (typeof Array.isArray === 'function') {\n\t\treturn Array.isArray(arr);\n\t}\n\n\treturn toStr.call(arr) === '[object Array]';\n};\n\nvar isPlainObject = function isPlainObject(obj) {\n\tif (!obj || toStr.call(obj) !== '[object Object]') {\n\t\treturn false;\n\t}\n\n\tvar hasOwnConstructor = hasOwn.call(obj, 'constructor');\n\tvar hasIsPrototypeOf = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');\n\t// Not own constructor property must be Object\n\tif (obj.constructor && !hasOwnConstructor && !hasIsPrototypeOf) {\n\t\treturn false;\n\t}\n\n\t// Own properties are enumerated firstly, so to speed up,\n\t// if last one is own, then all properties are own.\n\tvar key;\n\tfor (key in obj) { /**/ }\n\n\treturn typeof key === 'undefined' || hasOwn.call(obj, key);\n};\n\nmodule.exports = function extend() {\n\tvar options, name, src, copy, copyIsArray, clone;\n\tvar target = arguments[0];\n\tvar i = 1;\n\tvar length = arguments.length;\n\tvar deep = false;\n\n\t// Handle a deep copy situation\n\tif (typeof target === 'boolean') {\n\t\tdeep = target;\n\t\ttarget = arguments[1] || {};\n\t\t// skip the boolean and the target\n\t\ti = 2;\n\t}\n\tif (target == null || (typeof target !== 'object' && typeof target !== 'function')) {\n\t\ttarget = {};\n\t}\n\n\tfor (; i < length; ++i) {\n\t\toptions = arguments[i];\n\t\t// Only deal with non-null/undefined values\n\t\tif (options != null) {\n\t\t\t// Extend the base object\n\t\t\tfor (name in options) {\n\t\t\t\tsrc = target[name];\n\t\t\t\tcopy = options[name];\n\n\t\t\t\t// Prevent never-ending loop\n\t\t\t\tif (target !== copy) {\n\t\t\t\t\t// Recurse if we're merging plain objects or arrays\n\t\t\t\t\tif (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\t\tclone = src && isArray(src) ? src : [];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Never move original objects, clone them\n\t\t\t\t\t\ttarget[name] = extend(deep, clone, copy);\n\n\t\t\t\t\t// Don't bring in undefined values\n\t\t\t\t\t} else if (typeof copy !== 'undefined') {\n\t\t\t\t\t\ttarget[name] = copy;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the modified object\n\treturn target;\n};\n"
  ]
}